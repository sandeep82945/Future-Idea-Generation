Mobility-as-a-Service (MaaS) systems are two-sided markets, with two mutually exclusive sets of agents, i.e., travelers/users and operators, forming a mobility ecosystem in which multiple operators compete or cooperate to serve customers under a governing platform provider. This study proposes a MaaS platform equilibrium model based on many-to-many assignment games incorporating both fixed-route transit services and mobility-on-demand (MOD) services. The matching problem is formulated as a convex multicommodity flow network design problem under congestion (modeling the cost of accessing MOD services). The local stability conditions reflect a generalization of Wardropâ€™s principles that include operator decisions. Due to the presence of congestion, the problem may result in non-stable designs, and a subsidy mechanism from the platform is proposed to guarantee local stability. A new exact solution algorithm to the matching problem is proposed based on a branch and bound framework with a FrankWolfe algorithm integrated with Lagrangian relaxation and subgradient optimization, which guarantees the optimality of the matching problem but not stability. A heuristic which integrates stability conditions and subsidy design is proposed, which reaches either the optimal MaaS platform equilibrium solution with global stability, or a feasible locally stable solution that may require subsidy. For the heuristic, a worst-case bound and condition for obtaining an exact solution are both identified. Two sets of reproducible numerical experiments are conducted. The first, on a toy network, verifies the model and algorithm, and illustrates the differences between local and global stability. The second, on an expanded Sioux Falls network with 82 nodes and 748 links, derives generalizable insights about the model for coopetitive interdependencies between operators sharing the platform, handling congestion effects in MOD services, effects of local stability on investment impacts, and illustrating inequities that may arise under heterogeneous populations. 1 introduction With the development of information and communication technologies (ICT), new mobility services are emerging rapidly in recent years, such as bikeshare, micromobility, carshare, ride-hail and shared taxis, microtransit, and peer-to-peer ridesharing. Urban passenger transportation is being reshaped from a carbased paradigm to a multimodal one (Shaheen et al., 2020; Chow, 2018). The emergence of new mobility services gave rise to the concept of Mobiltiy-as-a-Service (MaaS) (Djavadian and Chow, 2017; Wong et al., 2020; Pantelidis et al., 2020), which provides mobility services through a joint digital or cyberphysical gateway that enables users to plan, book, and pay for multiple types of mobility services. Recent examples of such platforms include Moovit, Moovel, Whim, Masabi, HaCon, Cubic, FlexDanmark, MovePGH, and Cal-ITP, whose roles are not to operate mobility services but to serve as aggregators of different services (van den Berg et at., 2022; Xi et al., 2022; Zhou et al., 2022). A â€œplatformâ€ refers not to software, but to the broader definition of a type of â€œtwo-sidedâ€ market where buyers and sellers are simultaneously managed (Rochet and Tirole, 2006), which we adopt in this study. With more mobility providers entering the market, thereâ€™s a growing need for managing the operation
of mobility providers in MaaS platforms including Mobility-on-Demand (MOD) services that use ICTs. Existence of traditional transit and MOD providers result in MaaS ecosystems with higher levels of flexibility and volatility (Chow, 2018; Djavadian and Chow, 2017; Wong et al., 2020; Pantelidis et al., 2020), potentially generating greater social welfare (Zhou et al., 2022). MaaS platforms are two-sided markets with two mutually exclusive sets of agents, i.e., users and operators. Evaluation of MaaS platforms depends on both usersâ€™ route choices and operatorsâ€™ pricing and operation decisions. The emergent platform paradigm allows for such analysis. Rasulkhani and Chow (2019) proposed a game-theoretic platform-based model of MaaS systems with
unimodal trips, where each route is operated by one operator. Pantelidis et al. (2020) proposed a many-tomany assignment game method to model MaaS systems with multimodal trips, where each route can be operated by one or more fixed-route operators. The model consists of a matching problem modeled as a multicommodity capacitated fixed-charge network design problem (MCND) (Magnanti and Wong, 1984; Gendron and Larose, 2014), minimizing the sum of travel cost and operating cost (i.e. system cost). Corresponding to that problemâ€™s optimal solution is a set of stable outcomes that determines the requirements for different pricing mechanisms between the operators, the users, and the platform to ensure stability corresponding to the assignment. There are three unresolved problems in the earlier work. First, only fixed-route mobility providers are
modeled in the research above. MOD providers operate within and between selected service regions with a selected fleet size. Instead of hard capacities, MOD services are characterized by flow-dependent congested wait times. Second, while earlier studies do allow for elastic demand where users choose not to participate in the system, this feature was never explored in depth to understand the consequences. Third, while Sotomayor (1992) has shown that many-to-many assignment games in general exhibit nonempty stable outcome spaces, the proposed problem with MOD services has a more complex structure which makes it unclear whether the nonempty property holds. We show that empty stable outcome spaces are possible, which leads to an empty stable outcome space issue for the optimal assignment. Pantelidis et al. (2020) did not propose any solution method to solve the matching problem, much less address stability constraints. We propose new model extensions that substantially expand the applicability of the framework to
MaaS analysis and design efforts. The matching model from Pantelidis et al. (2020) is extended into a nonlinear mixed integer programming problem that considers trade-offs between congestion in MOD service, capacities in fixed-route transit, and decisions from travelers and both sets of operators. An exact solution algorithm is proposed to solve the matching problem. The algorithm has a branch and bound framework. Each branch is solved through Lagrangian relaxation and subgradient optimization with a Frank-Wolfe algorithm in each iteration. To deal with nonempty outcome spaces, we modify the algorithm into a bounded heuristic to derive solutions with guaranteed stable outcomes. Two sets of numerical experiments are conducted to verify the model, the algorithms, and evaluate their effectiveness in analyzing a range of MaaS design and analysis scenarios. The larger example is based on an expanded Sioux Falls
network with 82 nodes and 722 links that includes four fixed-route operators and three MOD operators considering overlapping service regions. The paper is structured as follows. Section 2 is the literature review. Section 3 introduces the
assignment game models. Section 4 introduces the solution algorithms. Section 5 presents two numerical examples and analyses. Section 6 presents the conclusion. 2 literature review MaaS platforms consist of three sets of decision-makers: travelers, mobility operators (which can fall into fixed-route services or MOD services), and the platform regulator. The travelers decide which multimodal paths they want to take; the operators decide which routes or zones to serve, amount of line capacity or fleet sizing, and cost transfers with travelers (e.g. fares, transfers between operating costs and user costs such as using virtual stops with increased access time and reduced routing cost); platform regulators can subsidize different operators or travelers and may have control over the design of the market. In the case of public platform regulators, decisions can further extend to design of the built environment. There are few studies that consider multiple operator settings, much less on MaaS platforms. Network
flow games (e.g. Derks & Tijs, 1985) tend to consider only noncooperative behavior between operators and ignore traveler route decisions. Generalized Stackelberg games (e.g. Zhou et al., 2005) that have upper level noncooperative games between operators and lower level user equilibrium model also only consider noncooperative decisions, assume leader-follower role between operators and travelers, and lack the platform/regulator role. Dandl et al. (2021) proposed a tri-level modeling approach considering a single operator with equilibrium determined through simulation. The leader-follower role makes less sense in MaaS if the system behaves more as a two-sided market. Other simulation-based methods also exist (Djavadian and Chow, 2017; Kucharski and Cats, 2022). Zhou et al. (2022) study the specific case of multiple MOD (ride-sourcing) providers competing for travelers which does not consider potential for collaboration in a common platform. Van den berg et al. (2022) propose models for different operating structures of MaaS but they lack network effects. Najmi et al. (2023) model the equilibrium of multimodal markets with multiple providers as a noncooperative game where every link in a road network has a cost of being served by a different mode/operator. MaaS platforms can be considered as assignment games. Operators are the â€œsellersâ€, users are the
â€œbuyersâ€, and the platform can find a role in the mechanism to determine the cost allocations, depending on their business model. An assignment game (Shapley and Shubik, 1971; Roth and Sotomayer,1992) is a special case of a stable matching problem (Gale and Shapley, 2013) in which utilities are transferable between buyers and sellers, where the matching is determined such that no one has incentive to break from their match. The availability of transferable utilities results in a space of outcomes of cost transfers between parties that would be stable. The game is defined by a matching problem and its corresponding stability conditions. The matching problem determines optimal matches while the corresponding set of stable cost allocation outcomes ensure that the optimal matching is also stable. Shapley and Shubik (1971) showed for the one-to-one assignment game, the matching problem is a linear program and the stable outcome subproblem is its dual, non-empty, and corresponds to the core. Sotomayor (1992) extended the problem to the â€œmultiple partners gameâ€, which is a many-to-many assignment game. She showed that the set of stable outcomes for an optimal assignment is nonempty and is a lattice subset of the core (Sotomayor, 1999). The assignment game has been adapted to model transportation services as many-to-one and many-to-
many assignment games. Each operator offers a service route that can match with multiple travelers up to a capacity (Rasulkhani and Chow, 2019) while travelers can transfer between multiple operators. The option for a traveler to match with multiple operators adds a layer of cooperation into the behavioral dynamics of this setting. Pantelidis et al. (2020) proposed a many-to-many assignment game model in which each buyer group is a distinct origin-destination-path, while each operator owns one or more links in a fixed-route service network (i.e. a link represents service from one origin to a destination, not a road segment). In that model, the matching problem is expanded from the assignment model in the one-to-one case (Shapley and Shubik, 1971) into a multicommodity network design (MCND) problem where buyers/travelers decide
paths to take while sellers/operators decide which links to operate. Meanwhile, the complementary stable outcome set is expanded to account for effects of fixed costs of operating a link as well as the binding capacity effects on stability. The model from Pantelidis et al. (2020) does not recognize MOD operators and their unique
characteristics. For example, a MOD service is typically defined as a fleet operating within a service region in which a traveler engages with the system in real time. There can be congestion for users to access the service: the smaller the fleet, the longer it takes for a traveler to access the service. The earliest example models of MOD services involve taxis, using macroscopic cost functions to capture the impedances of matching passengers with drivers (Yang et al., 2000, 2002, 2010; Yang and Yang, 2011) which have been further extended to general ride-hail services (He and Shen, 2015; Zha et al., 2018; Xu et al., 2021a,b; Zhang and Nie, 2021; Correa et al., 2021; Vignon et al., 2023). Existence of a stable outcome depends on the complicated relationship between trip utility, travel cost,
operating cost, and ownership of different parts of the network. If some matching pairs do not provide enough gain to be allocated between users and operators, the users may deviate from the routes selected in optimal matching or just end up unserved. Such issues can be solved by subsidizing the unstable matching pairs. More precisely, the MaaS platform/agencies can intervene by â€œinjectingâ€ subsidies to the unstable matching pairs to increase their potential gain to make sure that no user deviates from the matching. Tafreshian and Masoud (2020) used a minimum subsidy problem to obtain a stable outcome for a matching with empty core in peer-to-peer ridesharing matching games, which shows that subsidization is an effective way of stabilizing matchings. The most similar prior study is Xi et al. (2022), who proposed a bilevel problem in which the lower-
level model is a two-sided market. Like our study, they make use of a branch-and-bound type algorithm and assume linear wait time functions for MOD services. There are several key differences from our work. First, their model does not consider multimodal collaboration between multiple operators to serve a single passenger; in other words, this assumption likens their model to a â€œtransportation problemâ€ compared to our â€œmulticommodity flow problemâ€ with transshipment locations. Second, their model assumes operators and platform regulators that use a specific cost allocation mechanism (NYOP auction) whereas our model is mechanism-agnostic. Third (and most importantly), their model lacks a spatial component: i.e. travelers do not have specific origins and destination; network effects capture only a wait time component that depends on all users without considering link capacities or proximity to other zones and providers. Their model can be an effective tool for high level policy decision support, but limits applicability to network analysis and design. 3 proposed maas platform assignment game model The goal of this study is to build a model that recognizes congested MOD operations so that trade-offs can be analyzed regarding routes served and capacities, service regions and fleet sizes, market entry, elastic user demand for the platform, and subsidies from the platform. The modeling framework takes the original model in Pantelidis et al. (2020) and significantly expands upon that. As the model considers both traveler assignment as well as operator design decisions and platform policies, we call this more generalized model a â€œMaaS Platform Assignment Gameâ€. Consider a network managed by the MaaS platform initially defined as a directed graph ğº(ğ‘, ğ´) serving a set of traveler OD pairs ğ‘† traveling to/from centroids ğ‘ğ‘ âŠ‚ ğ‘. There exists a set of fixed-route operators ğ‘„ğ¹ such that each operator ğ‘“ âˆˆ ğ‘„ğ¹ owns one or more service links, ğ´ğ‘“ âŠ† ğ´ğ¹. A node connecting two service links owned by different operators can be expanded using transfer links ğ‘™ âˆˆ ğ´0 owned by no operator. ğ´0ğ‘“ denotes the transfer links to the services provided by operator ğ‘“ âˆˆ ğ‘„ğ¹ . Each fixed-route operator ğ‘“ decides whether to operate link ğ‘™ âˆˆ ğ´ğ‘“ between nodes ğ‘– and ğ‘—, and at what service frequency to operate on link ğ‘™ âˆˆ ğ´ğ‘“. To model such decisions, multiple links ğ‘™ âˆˆ ğ´ğ‘–ğ‘—ğ‘“ (ğ´ğ‘–ğ‘—ğ‘“ âŠ† ğ´ğ‘“ , ğ´ğ‘“ âŠ† ğ´ğ¹) controlled by ğ‘¦ğ‘™ âˆˆ {0,1} are created connecting the same two nodes ğ‘– and ğ‘— to represent the frequency or line capacity options. Each parallel link ğ‘™ âˆˆ ğ´ğ‘–ğ‘—ğ‘“ connecting ğ‘–, ğ‘— is associated with a capacity ğ‘¤ğ‘™, an operating cost ğ‘ğ‘™, and
a travel disutility ğ‘¡ğ‘™. Note that link travel disutilities here include disutilities of in-vehicle travel time and average wait time which is determined by service frequency. Parallel links with different frequencies have different travel disutilities and operating costs because increased frequency would reduce average wait time and increase operating cost. At most one of the parallel links can be chosen in each ğ´ğ‘–ğ‘—ğ‘“ . In practice, additional constraints can be added to fulfill other constraints of capacity selection, for example, ensuring that the same frequency/capacity is selected for service links that belong to the same line. MOD operators operate in regions instead of lines. Service region design can be modeled as choices
of whether to provide service in a set of zones and choices of fleet size to deploy in the chosen zones. We define ğ‘„ğ‘€ as the set of MOD operators in the MaaS platform. Alternative service zones of MOD operator ğ‘“ âˆˆ ğ‘„ğ‘€ are modeled as nodes using zone centroids ğ‘– âˆˆ ğ‘ğ‘“ğ‘§ , ğ‘“ âˆˆ ğ‘„ğ‘€. To represent wait/access cost of MOD services, MOD nodes are created separately from the MOD zone centroids; MOD zone centroids and fixed route links are all connected to origin-destination zone centroids through access/wait links. MOD services are provided between any pair of zones in the designed service region with a fleet size,
which can be represented as complete subgraphs connecting all served zone centroids in the service region. If different fleet size options â„ âˆˆ ğ»ğ‘“ are considered by an MOD operator ğ‘“ for a service region, different layers of complete subgraphs connecting different layers of MOD nodes are created to represent different fleet size options, each are connected with the MOD zone centroids with MOD access links. An MOD operator ğ‘“ operates with fleet size â„ âˆˆ ğ»ğ‘“ in a complete subgraph of nodes ğ‘ğ‘“â„ connected to every other node via links ğ´ğ‘“â„ = ğ‘ğ‘“â„ Ã— ğ‘ğ‘“â„ . In this case, each MOD node represents the combined choice of a zone and a fleet size as ğ‘£ğ‘– âˆˆ {0,1}, ğ‘– âˆˆ ğ‘ğ‘“â„. MOD access links ğ´0ğ‘“â„ connect zone centroids ğ‘ğ‘“ğ‘§ to MOD nodes ğ‘ğ‘“â„, representing a wait/access cost given fleet size â„ âˆˆ ğ»ğ‘“. The MOD access link set of operator ğ‘“ âˆˆ ğ‘„ğ‘€ is ğ´0ğ‘“ = â‹ƒ ğ´0ğ‘“â„â„âˆˆğ»ğ‘“ , where the MOD access link set of all MOD operators is ğ´0ğ‘€ = â‹ƒ ğ´0ğ‘“ğ‘“âˆˆğ‘„ğ‘€ . The MOD link set of MOD operator ğ‘“ âˆˆ ğ‘„ğ‘€ is ğ´ğ‘“ = â‹ƒ ğ´ğ‘“â„âˆˆğ»ğ‘“ and MOD link set of all MOD operators is ğ´ğ‘€ = â‹ƒ ğ´ğ‘“ğ‘“âˆˆğ‘„ğ‘€ . The MOD node set of MOD operator ğ‘“ âˆˆ ğ‘„ğ‘€ is ğ‘ğ‘“ = â‹ƒ ğ‘ğ‘“â„â„âˆˆğ»ğ‘“ . The MOD link set of all MOD operators is ğ‘ğ‘€ = â‹ƒ ğ‘ğ‘“ğ‘“âˆˆğ‘„ğ‘€ . A link set that consists of all links in the network is defined as ğ´ = ğ´ğ¹ âˆª ğ´0 âˆª ğ´ğ‘€ âˆª ğ´0ğ‘€ âˆª ğ´ğ·. Fig. 1 shows how to develop the network combining different alterantive fixed-route frequency and MOD service fleet designs. If detailed demand with OD pairs of coordinates are modeled, street networks can be used to connect origins, destinations, fixed-route transit stations, and MOD service zone centroids, although computational trade-offs will need to be considered. Fig. 1 shows an example of the latter. Each user group ğ‘  âˆˆ ğ‘† consists of a homogeneous population of travelers ğ‘‘ğ‘  corresponding to an OD pair, which can be further split into different classes of travelers per OD pair to model heterogeneity. Matching involves finding the link flows ğ‘¥ğ‘ ğ‘™ of link ğ‘™ âˆˆ ğ´ per user group ğ‘  âˆˆ ğ‘† such that travelersâ€™ disutilities converge to a user equilibrium and operatorsâ€™ costs are minimized. Travelers of user group ğ‘  âˆˆ ğ‘† are assumed to gain utility ğ‘ˆğ‘  upon completing their trip. Ma et al. (2021) provides an example of calibrating these utilities from existing travel modes. To allow for users to opt out of the MaaS platform, each OD pair ğ‘  âˆˆ ğ‘† is connected by an uncapacitated dummy link ğ‘™ âˆˆ ğ´ğ· , associated with a travel disutility ğ‘¡ğ‘  â‰¤ ğ‘ˆğ‘ , 0 operating cost, and infinite capacity. Travelers using these links are assumed to be not participating in the platform, instead using external modes, a competing platform, or not traveling. If a choice model was estimated as a logit model and the respective utility functions normalized to the common currency, then the travel disutility ğ‘¡ğ‘  can be calibrated as the logsum of these external modesâ€™ utility functions. For MOD access links, disutilities of wait/access time are modeled differently from the fixed-route
operations. Similar to the literature on matching functions for taxi and ride-hailing services, ğœğ‘™ is used for modeling traveler disutility as shown in Definition 1. Definition 1. The matching friction between travelers and MOD services at MOD service zones is modeled as the travel disutilities of MOD access links ğ‘™ âˆˆ ğ´0ğ‘€, representing the steady-state average access/wait times at the MOD service zones. A macroscopic disutility function ğœğ‘™(âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘  ; â„) is defined by Eq.(1). ğœğ‘™ (âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘  ; â„) = ğ‘1 (âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘  )
ğ‘1
â„ğ‘2 (1)
For MOD access links, travel disutilities are nonlinear, exhibiting congestion effects due to queueing for MOD service but no capacity effects. For MOD operators, their operating costs include supporting travelers to traverse MOD links and infrastructure cost of MOD nodes. The infrastructure cost of a MOD node represents the cost of setting up a zone for service for a given fleet size â„ (e.g. bike dock installation for bikesharing services), which is defined as a constant ğ‘ğ‘– for MOD node ğ‘– âˆˆ ğ´ğ‘€. Operating costs of links are also defined similarly from the literature as shown in Definition 2. Definition 2. Unit operating cost of MOD link ğ‘™ âˆˆ ğ´ğ‘€ between two served zones is defined as ğ‘šğ‘™, that is calibrated by the fleet size of the operator and other possible factors (e.g. link travel cost) as shown in Eq. (2), where ğ‘2 > 0 and ğ‘3 > 0. The parameters imply that as fleet size and demand increase, the unit operating cost increases. ğ‘šğ‘™ (âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘ 
; â„) = ğ‘2â„ ğ‘3 (2)
Since fleet size â„ is a constant for a MOD link ğ‘™ âˆˆ ğ´ğ‘€ given the network structure, the unit operating cost for traversing two zones is a calibrated constant that varies for different fleet sizes. Since the assignment game assumes a transferable-utility game, all utility-related parameters use a
common currency exchangeable between travelers and operators (e.g. dollars). 3.1 matching model considering fixed-route and mod operators The assignment game under these changes has the following nonlinear integer programming problem ğ¿1 in Eq. (3) as the new equilibrium matching problem. Matching problem ğ‘³ğŸ:
min ğ‘ğ¿1 = âˆ‘ âˆ‘ ğ‘¡ğ‘™ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´0âˆªğ´ğ¹âˆªğ´ğ‘€âˆªğ´ğ·ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ« ğœğ‘™(ğ‘¤; â„)ğ‘‘ğ‘¤ âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘†
0ğ‘™âˆˆğ´0ğ‘€
+ âˆ‘ ğ‘ğ‘™ğ‘¦ğ‘™ ğ‘™âˆˆğ´ğ¹ + âˆ‘ âˆ‘ ğ‘šğ‘™ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´ğ‘€ğ‘ âˆˆğ‘†
+ âˆ‘ ğ‘ğ‘–ğ‘£ğ‘– ğ‘–âˆˆğ‘ğ‘€
(3a)
subject to
âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´ğ‘– + âˆ’ âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´ğ‘– âˆ’
= { ğ‘‘ğ‘ , ğ‘– âˆˆ ğ‘‚ğ‘ ,
0, ğ‘œğ‘¡â„ğ‘’ğ‘Ÿğ‘¤ğ‘–ğ‘ ğ‘’, âˆ’ğ‘‘ğ‘ , ğ‘– âˆˆ ğ·ğ‘ , âˆ€ğ‘– âˆˆ ğ‘, âˆ€ğ‘  âˆˆ ğ‘† (3b)
âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘ âˆˆğ‘† â‰¤ ğ‘¤ğ‘™ğ‘¦ğ‘™ , âˆ€ğ‘™ âˆˆ ğ´ğ¹ (ğœ‡ğ‘™) (3c)
âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘ âˆˆğ‘† â‰¤ âˆ‘ ğ‘‘ğ‘  ğ‘ âˆˆğ‘†
ğ‘£ğ‘–, âˆ€ğ‘– âˆˆ ğ‘ğ‘€ , âˆ€ğ‘™ âˆˆ ğ´ğ‘– + (3d)
âˆ‘ ğ‘¦ğ‘™ ğ‘™âˆˆğ´ğ‘–ğ‘—ğ‘“ â‰¤ 1, âˆ€ğ´ğ‘–ğ‘—ğ‘“ âŠ† ğ´ğ¹ (3e)
ğ‘£ğ‘– + ğ‘£ğ‘— â‰¤ 1, âˆ€ğ‘– âˆˆ ğ‘ğ‘“â„ , âˆ€ğ‘— âˆˆ ğ‘ğ‘“â„â€² , âˆ€(â„, â„ â€²) âˆˆ ğ»ğ‘“ Ã— ğ»ğ‘“ , â„ â‰  â„â€², âˆ€ğ‘“ âˆˆ ğ‘„ğ‘€ (3f)
ğ‘¥ğ‘ ğ‘™ â‰¥ 0, âˆ€ğ‘™ âˆˆ ğ´, âˆ€ğ‘  âˆˆ ğ‘† (3g) ğ‘¦ğ‘™ âˆˆ {0,1}, âˆ€ğ‘™ âˆˆ ğ´ğ¹ (3h) ğ‘£ğ‘– âˆˆ {0,1}, âˆ€ğ‘– âˆˆ ğ‘ğ‘€ (3i)
Eq. (3a) includes the term âˆ‘ âˆ« ğœğ‘™(ğ‘¤; â„)ğ‘‘ğ‘¤ âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘†
0ğ‘™âˆˆğ´0ğ‘€ to capture the user equilibrium under congestion
effect for using MOD service. The objective represents selfish travelers and operators, where only travelers face congestion effects represented by Beckmannâ€™s formulation and the operating costs are agnostic to the cost allocation mechanism. Such structure allows us to find effective exact solutions for the problem in Section 4. Eq. (3b) are the flow conservation constraints, where the set of outbound links of node ğ‘– is defined as ğ´ğ‘– +, and the set of inbound links of node ğ‘– is defined as ğ´ğ‘– âˆ’. Eq. (3c) are the capacity constraints with Lagrange multiplier ğœ‡ğ‘™. Eq. (3d) are the MOD node controlling constraints, which ensure that flows can only exist between two MOD nodes if both nodes are opened. Only when ğ‘£ğ‘– = 1, can the flows on the outbound links of MOD node ğ‘– be positive. Eq. (3e) ensures that only one service frequency/capacity is chosen for each fixed-route link (ğ‘–, ğ‘—) by operator ğ‘“. Eq. (3f) ensures that only one fleet size is chosen by each MOD operator. When ğ‘£ğ‘– = 1, then ğ‘£ğ‘— = 0 for all other nodes ğ‘— owned by the same operator as ğ‘– but associated with different fleet sizes. Eqs. (3g) â€“ (3i) are non-negativity and binary constraints. The model is a nonlinear integer program; when travel costs are constant, it simplifies to an NP-hard MCND problem (Magnanti and Wong, 1984). This belongs to the class of convex multicommodity network design problems
(Crainic and Rousseau, 1986; Paraskevopoulos et al., 2016), although those tend to consider a system optimal formulation and include both congestion and capacity effects on the same links whereas Eq. (3) does not. 3.2 corresponding stability conditions The stable outcome space corresponding to ğ¿1 is shown in Eqs. (4a) â€“ (4f). In this study we focus on linkadditive pricing policy. We denote ğ‘ğ‘™ as the fare of link ğ‘™ and ğ‘¢ğ‘  as the payoff of a user on OD pair ğ‘  âˆˆ ğ‘†. The variables ğ‘¥ğ‘™ğ‘  âˆ— , ğ‘¦ğ‘™ âˆ—, ğ‘£ğ‘– âˆ— and ğœ‡ğ‘™ âˆ— represent the optimal flow on link ğ‘™ âˆˆ ğ´ on OD pair ğ‘  âˆˆ ğ‘† , optimal operation choice of fixed-route link ğ‘™ âˆˆ ğ´ğ¹, optimal operation choice of MOD node ğ‘™ âˆˆ ğ‘ğ‘€, and Lagrange multiplier of fixed-route link ğ‘™ âˆˆ ğ´ğ¹ from the matching problem ğ¿1. ğ‘…ğ‘  âˆ— is the set of optimal paths for user ğ‘  âˆˆ ğ‘† corresponding to the solution of Eq. (3). ğ‘…ğ‘  is the set of all paths connecting OD pair ğ‘  âˆˆ ğ‘†. ğ´ğ‘Ÿ denotes the set of links that compose of one or more matched paths ğ‘Ÿ âˆˆ ğ‘…ğ‘ 
âˆ—, ğ‘  âˆˆ ğ‘†. ğ´ğ‘Ÿâ€² denotes the set of links that compose an unmatched path ğ‘Ÿâ€² âˆˆ ğ‘…ğ‘ \ğ‘…ğ‘ 
âˆ—, ğ‘  âˆˆ ğ‘†. Eqs. (4a) â€“ (4b) represent minimum operator costs. Eq. (4c) ensures utility conservation. Eq. (4d) ensures that an outcome is locally stable, i.e. there is no incentive for a single traveler to switch to another path. âˆ‘ ğ‘ğ‘™ âˆ‘ ğ‘¥ğ‘ ğ‘™ âˆ— ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´ğ‘“ â‰¥ âˆ‘ ğ‘ğ‘™ âˆ—ğ‘¦ğ‘™ âˆ— ğ‘™âˆˆğ´ğ‘“ , âˆ€ğ‘“ âˆˆ ğ‘„ğ¹ (4a)
âˆ‘ ğ‘ğ‘™ âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´0ğ‘“
â‰¥ âˆ‘ âˆ‘ ğ‘šğ‘™ğ‘¥ğ‘ ğ‘™ âˆ—
ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´ğ‘“
+ âˆ‘ ğ‘ğ‘–ğ‘£ğ‘– âˆ—
ğ‘–âˆˆğ‘ğ‘“
, âˆ€ğ‘“ âˆˆ ğ‘„ğ‘€ (4b)
ğ‘¢ğ‘  + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ = ğ‘ˆğ‘  âˆ’ ( âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâˆ©(ğ´0âˆ©ğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†
; â„)
ğ‘™âˆˆğ´ğ‘Ÿâˆ©ğ´0ğ‘€
) , âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘† (4c)
ğ‘¢ğ‘  + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€² â‰¥ ğ‘ˆğ‘ 
âˆ’ ( âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ— + ğ‘ğ‘™(1 âˆ’ ğ‘¦ğ‘™ âˆ—))
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— + 1
ğ‘ âˆˆğ‘†
; â„)
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´0ğ‘€
+ âˆ‘ ğ‘šğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´ğ‘€
+ âˆ‘ ğ‘ğ‘–(1 âˆ’ ğ‘£ğ‘– âˆ—)
ğ‘–âˆˆğ‘ğ‘Ÿâ€²âˆ©ğ‘ğ‘€
) , âˆ€ğ‘Ÿâ€² âˆˆ ğ‘…ğ‘ \ğ‘…ğ‘  âˆ—, ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†
(4d)
ğ‘¢ğ‘  â‰¥ 0, âˆ€ğ‘  âˆˆ ğ‘† (4e) ğ‘ğ‘™ â‰¥ 0, âˆ€ğ‘™ âˆˆ ğ´ğ‘Ÿ, ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘† (4f)
The passenger path flow stability condition shown in Eq. (4d) is proven to correspond to the fixed-
route operator market assignment in Pantelidis et al. (2020) under a more complex non-additive fare policy. With added MOD operators, the stability condition is trivially extended but stated formally here for sake of completeness. Proposition 1. Solution stability. An optimal solution (ğ’™, ğ’š, ğ’—) to Eq. (3) is locally stable if there exists one or more solutions (ğ’–, ğ’‘) that satisfy Eqs. (4a) â€“ (4f), where ğ’– is the vector of utility transferred to travelers and ğ’‘ is the utility vector normalized as the fare payment from travelers to operators. Proof. The operator cost constraints (Eq. (4a)-(4b)) and utility conservation constraints (Eq. (4c)) are
feasibility conditions. Eq. (4d) ensures the local stability of the matched paths. Pantelidis et al. (2020) shows the case for only fixed-route operators, traveler paths may switch to alternative paths. Here we follow the same logic considering two possible conditions of switching one user (local stability consideration) from the matched path to the alternative unmatched path:
Condition 1: The unmatched path is fully operated, including fixed-route links and MOD nodes and
links. In this case, similar to Pantelidis et al. (2020), if a capacitated fixed-route link ğ‘™ on the unmatched path is already at capacity, switching one user in requires pushing someone else off at the capacity price ğœ‡ğ‘™ âˆ—. Condition 2: The unmatched path is not fully operated. If a capacitated fixed-route link ğ‘™ on the unmatched path is not operated (ğ‘¦ğ‘™
âˆ— = 0), the switched user would have to pay for the operating cost of the link (ğ‘ğ‘™(1 âˆ’ ğ‘¦ğ‘™
âˆ—)) in addition to travel cost. If a MOD segment of the path is not operated, the unoperated MOD segment should include one or more MOD nodes (ğ‘£ğ‘–
âˆ— = 0), MOD link ğ‘™1, MOD access link ğ‘™2, and MOD egress link ğ‘™3. The switched user would have to pay for the opening cost of the unopened MOD nodes (ğ‘ğ‘–(1 âˆ’ ğ‘£ğ‘– âˆ—)), the additional cost of operating on link ğ‘™1 for one more user (ğ‘šğ‘™1), as well as the travel cost of the path. For the MOD access link ğ‘™2, travel cost is changed to ğœğ‘™2(âˆ‘ ğ‘¥ğ‘™2ğ‘  âˆ— + 1ğ‘ âˆˆğ‘† ; â„) due to the switch.âˆ
Like Shapley and Shubik (1971) and Pantelidis et al. (2020), the proposed assignment game model is
mechanism-agnostic; it does not output a specific cost allocation but instead outputs the set of all stable outcomes corresponding to the optimal matching by identifying two extreme vertices: buyer- and selleroptimal solutions. This is not to be confused with â€œuser equilibriumâ€ and â€œsocial optimumâ€ in the transportation assignment literature; in essence every outcome is a â€œuser equilibriumâ€ with different cost transfers (see Section 3.3). The vertices can be identified by solving ğ¿2 with either Eq. (5a) (buyer-optimal) or (5b) (seller-optimal), where all solutions in between these vertices are also stable. Stable outcome problem ğ‘³ğŸ: max âˆ‘ ğ‘¢ğ‘ ğ‘ âˆˆğ‘† (Buyer optimal)
or
max âˆ‘ âˆ‘ ğ‘ğ‘™ âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´0ğ‘“ğ‘“âˆˆğ¹ (Seller optimal)
(5a)
(5b)
Subject to Eqs. (4). Note that the cost allocation constraints are path-dependent, while the flows solved from ğ¿1 are linkbased. This will be dealt with in the solution algorithm discussed in Section 4. In addition, not all links are owned by operators in the platform; these include transfer links, access/egress links to stations, and the dummy links connecting OD pairs representing options alternative to the platform. 3.3 model properties and discussion  3.3.1. instability for an optimal solution to ğ‘³ğŸ While Sotomayor (1992) proved that basic many-to-many assignment games have non-empty stable outcome sets, the proposed MaaS assignment game features network effects that complicate the problem. With selfish travelers under congestion and the impact on operators, it is possible that the optimal solution to ğ¿1 may not satisfy one or more of the constraints in Eq. (4) (Lemma 1), since the travel disutility terms in the objective function of ğ¿1 (Eq. (3a)) are not cost-minimizing but reflect integrals of average cost. Lemma 1. Empty outcome space. The assignment game in ğ¿1 (Eqs. (3)) is not guaranteed to be stable, i.e. have a non-empty outcome set from Eqs. (4a) â€“ (4f). Proof. Denote the matched but unstable path as ğ‘Ÿ, and the path that users on ğ‘Ÿ have incentives to switch to as ğ‘Ÿâ€². The two paths connect the same OD pair. Since ğ‘Ÿ is chosen over ğ‘Ÿâ€² by the matching problem ğ¿1, we have Eq. (6). It means that the total cost of the flow on ğ‘Ÿ is less than the cost of allocating the flow to ğ‘Ÿâ€² (the part of ğ‘Ÿ shared with other matched paths still operating, and the part of ğ‘Ÿâ€² that is not operating starts operating). Flow on path ğ‘Ÿ is denoted as ğ‘¥ğ‘Ÿ . Set of links on paths ğ‘Ÿ and ğ‘Ÿâ€² are denoted as ğ´ğ‘Ÿ and ğ´ğ‘Ÿâ€² , respectively. The set of operating links on ğ‘Ÿ that serves not only users on ğ‘Ÿ but also users on other matched paths is denoted as ğ´ğ‘Ÿ,ğ‘ â„ğ‘ğ‘Ÿğ‘’ğ‘‘. Set of links not operated on the unmatched path ğ‘Ÿâ€² is denoted as ğ´ğ‘Ÿâ€²,ğ‘›ğ‘œ. ğ‘¥ğ‘Ÿ âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ < ğ‘¥ğ‘Ÿ âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€² + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ,ğ‘ â„ğ‘ğ‘Ÿğ‘’ğ‘‘ + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²,ğ‘›ğ‘œ
(6)
The condition of ğ‘Ÿ being unstable with respect to ğ‘Ÿâ€² is shown as Eq. (7), which is derived by solving ğ‘¢ğ‘  from Eq. (4b) and plugging in the solved ğ‘¢ğ‘  into Eq. (4c). âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ
â‰¥ âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ—)
ğ‘™âˆˆğ´ğ‘Ÿâ€²
+ âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€² + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²,ğ‘›ğ‘œ
(7)
Multiplying Eq. (7) by ğ‘¥ğ‘Ÿ and combining with Eq. (6), we have Eq. (8), which is the condition of a matched path ğ‘Ÿ being unstable. ğ‘¥ğ‘Ÿ âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ âˆ’ âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ
> ğ‘¥ğ‘Ÿ âˆ‘ ğœ‡ğ‘™ âˆ—
ğ‘™âˆˆğ´ğ‘Ÿâ€²
+ ğ‘¥ğ‘Ÿ âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€² âˆ’ âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ,ğ‘ â„ğ‘ğ‘Ÿğ‘’ğ‘‘ + (ğ‘¥ğ‘Ÿ âˆ’ 1) âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²,ğ‘›ğ‘œ
(8)
âˆ
Lemma 1 shows that ğ¿1 on its own may not be stable. As such, we define a more constrained version of ğ¿1 that includes a local stability guarantee, named as ğ¿1ğ¶ . The optimal solution to ğ¿1ğ¶ is a market equilibrium for the platform design that is guaranteed to be stable in Definition 3. Definition 3. Let ğ¿1ğ¶ be the assignment game defined by ğ¿1 plus the added constraint of guaranteed local stability. The optimal solution to ğ¿1ğ¶ is a MaaS platform equilibrium, where ğ‘ğ¿1 âˆ— â‰¤ ğ‘ğ¿1ğ¶ âˆ— . No user can unilaterally switch path without being worse off, and no operator can unilaterally change their decision without being worse off for any outcome in the non-empty stable outcome set, and cooperative behavior between operators is possible in serving a user path together. An example is shown in Fig. 2. There are 2 OD pairs in the network, 1 to 3 and 1 to 2, both with 100
units of demand. Link travel costs and operating costs are labeled in Fig. 2. Links (1,3) and (2,3) are walking links without operating cost and not owned by any operator. Dummy links for the two OD pairs are drawn in yellow with dashed lines with travel costs labeled. Utility ğ‘ˆğ‘  of the 2 OD travelers are both 25. All links have infinite capacity. The optimal matched flows solved from ğ¿1 are 200 units on link (1,2) and 100 units on link (2,3). However, the matched path for OD1, which is [1,2,3], is an unstable path, despite the equilibration in route assignment in Eq. (3a), because of the subsequent cost transfer. The lowest fare that can be set for link (1,2) is 2.4, so the total cost for one user on path [1,2,3] is 12 + 6 + 2.4 = 20.4, which is greater than the cost of walking path [1,3]. This means that the users on path [1,2,3] have incentives of switching to walking path [1,3]. The condition of Eq. (8) holds in this case (left-hand side = -240, righthand side = -480). When instability happens, flow on the unstable path have incentive to switch to unmatched paths. In
the example shown in Fig. 2, after the first user switches to walking path [1,3], the fare of link (1,2) will increase, which leads to more users switching to walking path [1,3]. The system stabilizes when all the 100 units of flow on path [1,2,3] have switched to walking path [1,3], which is the MaaS platform equilibrium. However, the equilibrium objective increases after the switch (before: ğ‘ğ¿1 âˆ— = 3,480; after: ğ‘ğ¿1ğ¶ âˆ— = 3,680). The stability condition that we consider is local stability, i.e. there is no incentive for one user to switch
off his/her current path. It is possible that a locally stable outcome may not be globally stable, i.e. there could be a pair of users that may swap that would lead to a better outcome. This is similar to the difference between a â€œuser equilibriumâ€ and a â€œuser optimumâ€ in Smith (1984), where we align the local stability constraints in Eq. (4) with â€œuser equilibriumâ€, but seek the â€œuser optimumâ€ by optimizing ğ¿1ğ¶ (Proposition 2). Proposition 2. Local and global stability. A feasible solution to ğ¿1ğ¶ may be locally stable without being optimal (local stability is a necessary but not sufficient condition); the optimal solution to ğ¿1ğ¶ is globally stable. Proof. As proven by Proposition 1, Eqs. (4a) â€“ (4f) ensures local stability, i.e. there is no incentive for a single traveler to switch to another path. Given only links with fixed link costs (transfer links and fixed-route links), the cost per user on
unmatched path ğ‘Ÿâ€² when ğ‘› users switch to unmatched path ğ‘Ÿâ€² is âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ— + ğ‘ğ‘™(1 âˆ’ ğ‘¦ğ‘™ âˆ—))ğ‘™âˆˆğ´ğ‘Ÿâ€² + âˆ‘ ğ‘ğ‘™(1âˆ’ğ‘¦ğ‘™
âˆ—)ğ‘™âˆˆğ´ğ‘Ÿâ€² ğ‘› , which monotonically decreases while ğ‘› increases, indicating that more users will switch to path ğ‘Ÿâ€² if the path ğ‘Ÿâ€² is worthwhile for the first user to switch to. In this case, local stability ensures global stability. Given links with congestion effects (MOD access links), the cost per user on unmatched path ğ‘Ÿâ€² when
ğ‘› users switch to unmatched path ğ‘Ÿâ€² is ğ‘ˆğ‘  âˆ’ (âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ—)ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€) + âˆ‘ ğœğ‘™(âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— +ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´0ğ‘€ 1 ; â„) + âˆ‘ ğ‘šğ‘™ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´ğ‘€ + âˆ‘ ğ‘ğ‘–(1âˆ’ğ‘£ğ‘– âˆ—)ğ‘–âˆˆğ‘ğ‘Ÿâ€²âˆ©ğ‘ğ‘€ +âˆ‘ ğ‘ğ‘™(1âˆ’ğ‘¦ğ‘™ âˆ—)ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€) ğ‘› ), in which the last term decrease while ğ‘› increases, while the second term increases while ğ‘› increases. In this latter case, it is possible that the lowest payoff per user switched appears when more than one user switches to the unmatched path ğ‘Ÿâ€², which means that local stability does not ensure global stability when there are congestion effects. Among all the locally stable solutions, the solution with the lowest objective value (ğ‘ğ¿1ğ¶ âˆ— ) is the MaaS platform equilibrium, which is globally stable, since the lowest objective value in Eq. (3) indicates no incentives of switching in the platform. âˆ 3.3.2. unique and non-unique variables As shown in Sotomayor (1999), the many-to-many assignment game has a unique lattice structure for its stable outcome set and there exists a unique optimal stable payoff for each side of the market (buyer- and seller-optimal vertices). From the network properties, however, Pantelidis et al. (2020) also showed that certain variables are unique even if the path flows are not unique. Proposition 3. Solution uniqueness. A MaaS platform equilibrium solution under a link-additive and separable pricing scheme is unique in link flows, passenger ridership per operator, and the sum of total consumer surplus and total operator revenue. Proof. Link flows are known to be unique for multicommodity assignment models under congestion
(Sheffi, 1985). As mentioned, we consider two alternative pricing schemes: a link-based price and a nonadditive price that is paid once to an operator regardless of how many legs of the trip belong to that operator. The latter scheme was studied in Pantelidis et al. (2020). Here we study the former, which is formulated as the conditions in ğ¿2. Since flow of link ğ‘™ is unique (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— ğ‘ âˆˆğ‘† ), system travel cost is unique (âˆ‘ âˆ‘ ğ‘¡ğ‘™ğ‘¥ğ‘™ğ‘  âˆ— ğ‘™âˆˆğ´0âˆªğ´ğ¹âˆªğ´ğ‘€âˆªğ´ğ·ğ‘ âˆˆğ‘† + âˆ‘ ğœğ‘™(âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— ğ‘ âˆˆğ‘† ; â„) âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´0ğ‘€ ). System total trip utility is unique (âˆ‘ ğ‘‘ğ‘ ğ‘ˆğ‘ ğ‘ âˆˆğ‘† ). Since the sum of system travel cost, system total consumer surplus, and total operator revenue is equal to system total trip utility,
the sum of system total consumer surplus and total operator revenue is unique despite the non-uniqueness of path flows. âˆ
3.3.3. Generalization of Wardropâ€™s principles
The assignment game stability conditions shown in Eq. (4) represent a more generalized form of the
noncooperative user equilibrium route choice behavior proposed by Wardrop (1952) with added operator considerations and cooperation for operators in serving a user path together. Corollary 1. Generalization of Wardropâ€™s user equilibrium. When ğ‘„ = {}, i.e. there is no operator agent and the platform becomes a one-sided market, the stable outcome space defined by the constraints in Eq. (4) is determined only by ğ‘¢ğ‘  (ğ‘ğ‘™ â€™s drop out), which leads to a generalization of the Wardropâ€™s user equilibrium conditions (1952) with known ğ‘ˆğ‘  and link capacities. Proof. Without operators, Eqs. (4a) â€“ (4b) drop out. Removing the operator terms in the stability
constraint in Eqs. (4c) â€“ (4d) leads to Eqs. (4câ€™) â€“ (4dâ€™). ğ‘¢ğ‘  = ğ‘ˆğ‘  âˆ’ ( âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâˆ©(ğ´0âˆ©ğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†
; â„ğ‘™)
ğ‘™âˆˆğ´ğ‘Ÿâˆ©ğ´0ğ‘€
) , âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘† (4câ€™)
ğ‘¢ğ‘  â‰¥ ğ‘ˆğ‘  âˆ’ ( âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ—)
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— + 1
ğ‘ âˆˆğ‘†
; â„ğ‘™)
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´0ğ‘€
) , âˆ€ğ‘Ÿâ€² âˆˆ ğ‘…ğ‘ \ğ‘…ğ‘  âˆ—, ğ‘Ÿ
âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†
(4dâ€™)
If we combine Eqs. (4câ€™) and (4dâ€™) and assume that all links are uncapacitated, we have Eq. (9), which
is in fact the KKT conditions corresponding to the user equilibrium as shown in Beckmann et al. (1956). The left-hand side is the travel cost of the matched path ğ‘Ÿ. The right-hand side is the cost of switching to an unmatched path ğ‘Ÿâ€², which is travel cost of the unmatched paths. âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâˆ©(ğ´0âˆ©ğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†
; â„)
ğ‘™âˆˆğ´ğ‘Ÿâˆ©ğ´0ğ‘€
â‰¤ âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— + 1
ğ‘ âˆˆğ‘†
; â„)
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´0ğ‘€
, âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†, âˆ€ğ‘Ÿâ€²
âˆˆ ğ‘…ğ‘ \ğ‘…ğ‘  âˆ—, ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†
(9)
âˆ 3.4 subsidy for system stabilization The MaaS platform assignment game so far does not involve any decisions from the platform. As
solving ğ¿1 may not obtain a solution to ğ¿1ğ¶, we consider subsidy decisions for the platform to guarantee local stability. We introduce the role of subsidy in stabilizing an unstable assignment as a platform design strategy first considered by Tafreshian and Masoud (2020) for ridesharing markets. When unstable paths are subsidized sufficiently to enlarge the payoff, they can still be stabilized, and the result may even outperform the solution to ğ¿1ğ¶. In MaaS platforms, users pay one time for a bundle of mobility services which compose a path, so it might make sense for subsidies per user and per path. Consider a path-based subsidy ğ‘ğ‘Ÿ directed to each user on path ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†, such that the travel disutility is decreased by that amount per user in Definition 4. Definition 4. ğ‘³ğŸğ‘º is a variant of the ğ¿1 assignment game with the added decision variable for the platform decision-maker to provide path-based subsidies ğ‘ğ‘Ÿ for path ğ‘Ÿ âˆˆ ğ‘…ğ‘ 
âˆ—, ğ‘  âˆˆ ğ‘† such that the equilibrium objective is minimized, i.e. in Eq. (10), where ğ‘¥ğ‘Ÿ is the flow on path ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†.
min ğ‘ğ¿1ğ‘† = ğ‘ğ¿1 + âˆ‘ âˆ‘ ğ‘ğ‘Ÿğ‘¥ğ‘Ÿ ğ‘Ÿâˆˆğ‘…ğ‘  âˆ—ğ‘ âˆˆğ‘†
(10)
The optimal solution to ğ¿1ğ‘† is called a subsidized MaaS platform equilibrium, where ğ‘ğ¿1 âˆ— â‰¤ ğ‘ğ¿1ğ‘† âˆ— . In the example of Fig. 2, instability of path [1,2,3] happens due to larger cost per user (âˆ‘ ğ‘¡ğ‘–ğ‘—ğ´ğ‘Ÿ + âˆ‘ ğ‘ğ‘–ğ‘—ğ´ğ‘Ÿ ) than the walking path [1,3]. Obviously, such instability can be fixed by injecting subsidies ğ‘[1,2,3] to lower the cost of the unstable path [1,2,3]. In this example, a subsidy of ğ‘[1,2,3] = 0.4 is needed for each user on path [1,2,3] to make sure that they donâ€™t switch to walking path [1,3]. Without any intervention, the flow on [1,2,3] will switch to the walking path [1,3], leading to ğ‘ğ¿1ğ¶ âˆ— = 3,680. With the subsidy included, the subsidized equilibrium objective is ğ‘ğ¿1ğ‘† âˆ— = 3,480 + 40 = 3,520 , which is still lower than the equilibrium objective of 3,680. This means that subsidizing the matchings solved from ğ¿1 is worthwhile in this case. However, if the cost of link (1,3) is decreased from 20 to 18.5, the flows solved from ğ¿1 stays the same, while subsidy needed to stabilize path [1,2,3] becomes ğ‘[1,2,3] = 1.4 per user. The subsidized equilibrium objective becomes ğ‘ğ¿1ğ‘† âˆ— = 3,620. In this case, the equilibrium objective is ğ‘ğ¿1ğ¶ âˆ— = 3,580, which means that it is not worthwhile to inject subsidies. ğ¿1ğ‘† is a highly complex problem since the objective (10) and constraints are nonconvex. We can equivalently decompose the problem into finding a solution to ğ¿1 and solving for ğ‘ğ‘Ÿ
âˆ— in ğ¿3 given the variables obtained from ğ¿1 if they are unstable, i.e. Definition 5. Definition 5. ğ‘³ğŸ‘ finds the optimum subsidies ğ‘ğ‘Ÿ needed for a given solution (ğ’™ âˆ—, ğ’šâˆ—, ğ’—âˆ—) with an empty outcome set such that it is no longer empty. Then ğ‘ğ¿1ğ‘† âˆ— = min(ğ‘ğ¿1(ğ’™ âˆ—, ğ’šâˆ—, ğ’—âˆ—) + ğ‘ğ¿3|(ğ’™âˆ—,ğ’šâˆ—,ğ’—âˆ—)). Minimum Subsidy Problem ğ‘³ğŸ‘:
min ğ‘ğ‘Ÿ,ğ‘¢ğ‘ ,ğ‘ğ‘™
ğ‘ğ¿3|(ğ’™âˆ—,ğ’šâˆ—,ğ’—âˆ—) = âˆ‘ âˆ‘ ğ‘ğ‘Ÿğ‘¥ğ‘Ÿ âˆ—
ğ‘Ÿâˆˆğ‘…ğ‘  âˆ—ğ‘ âˆˆğ‘†
(11a)
Subject to
âˆ‘ ğ‘ğ‘™ âˆ‘ ğ‘¥ğ‘ ğ‘™ âˆ— ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´ğ‘“ â‰¥ âˆ‘ ğ‘ğ‘™ âˆ—ğ‘¦ğ‘™ âˆ— ğ‘™âˆˆğ´ğ‘“ , âˆ€ğ‘“ âˆˆ ğ‘„ğ¹ (11b)
âˆ‘ ğ‘ğ‘™ âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´0ğ‘“
â‰¥ âˆ‘ âˆ‘ ğ‘šğ‘™ğ‘¥ğ‘ ğ‘™ âˆ—
ğ‘ âˆˆğ‘†ğ‘™âˆˆğ´ğ‘“
+ âˆ‘ ğ‘ğ‘–ğ‘£ğ‘– âˆ—
ğ‘–âˆˆğ‘ğ‘“
, âˆ€ğ‘“ âˆˆ ğ‘„ğ‘€ (11c)
ğ‘¢ğ‘  + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿ = ğ‘ˆğ‘  + ğ‘ğ‘Ÿ âˆ’ ( âˆ‘ ğ‘¡ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâˆ©(ğ´0âˆ©ğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ—
ğ‘ âˆˆğ‘†
; â„ğ‘™)
ğ‘™âˆˆğ´ğ‘Ÿâˆ©ğ´0ğ‘€
) , âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, âˆ€ğ‘ 
âˆˆ ğ‘†
(11d)
ğ‘¢ğ‘  + âˆ‘ ğ‘ğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€² â‰¥ ğ‘ˆğ‘ 
âˆ’ ( âˆ‘ (ğ‘¡ğ‘™ + ğœ‡ğ‘™ âˆ— + ğ‘ğ‘™(1 âˆ’ ğ‘¦ğ‘™ âˆ—))
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©(ğ´0âˆªğ´ğ¹âˆªğ´ğ·âˆªğ´ğ‘€)
+ âˆ‘ ğœğ‘™ (âˆ‘ ğ‘¥ğ‘™ğ‘  âˆ— + 1
ğ‘ âˆˆğ‘†
; â„ğ‘™)
ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´0ğ‘€
+ âˆ‘ ğ‘šğ‘™ ğ‘™âˆˆğ´ğ‘Ÿâ€²âˆ©ğ´ğ‘€
+ âˆ‘ ğ‘ğ‘–(1 âˆ’ ğ‘£ğ‘– âˆ—)
ğ‘–âˆˆğ‘ğ‘Ÿâ€²âˆ©ğ‘ğ‘€
) , âˆ€ğ‘Ÿâ€²
âˆˆ ğ‘…ğ‘ \ğ‘…ğ‘  âˆ—, âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, âˆ€ğ‘  âˆˆ ğ‘†
(11e)
ğ‘¢ğ‘  â‰¥ 0, âˆ€ğ‘  âˆˆ ğ‘† (11f)
ğ‘ğ‘™ â‰¥ 0, âˆ€ğ‘™ âˆˆ ğ´ğ‘Ÿ, âˆ€ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, âˆ€ğ‘  âˆˆ ğ‘† (11g)
ğ‘ğ‘Ÿ â‰¥ 0, âˆ€ ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, âˆ€ğ‘  âˆˆ ğ‘† (11h)
There are three sets of decision variables: userâ€™s payoff of user group ğ‘  âˆˆ ğ‘† (ğ‘¢ğ‘ ), fare of link ğ‘™ âˆˆ ğ´ğ‘Ÿ, ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘† (ğ‘ğ‘™), and subsidy to each user on path ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘† (ğ‘ğ‘Ÿ). Subsidies are injected per path per user to increase trip utilities, which is reflected in the cost allocation constraints (Eq. (11d)). The objective (Eq. (11a)) is to minimize the total amount of subsidies injected. Since subsidy is injected per path per user, path flows are needed for total subsidies in Eq. (11a). 4 proposed solution algorithms The challenge is in solving for a MaaS platform equilibrium with guaranteed local stability, with or without subsidy. We propose a branch and bound algorithm that can obtain the exact solution to the many-to-many matching model ğ¿1 in Section 4.1, but stability is not guaranteed per Lemma 1. For obtaining a solution with guaranteed stability, i.e. the MaaS platform equilibrium, we integrate ğ¿2 and ğ¿3 as shown in Section 4.2. 4.1. exact solution method to the many-to-many matching model ğ‘³ğŸ The algorithm is composed of 3 parts nested within each other: branch and bound (Land and Doig, 2010), Lagrangian relaxation with subgradient optimization, and Frank-Wolfe algorithm. An overview of the complete algorithm is presented in Fig. 3 (which also contains parts introduced in 4.2). The integral constraints of ğ‘¦ğ‘–ğ‘— and ğ‘£ğ‘–â„ are relaxed in the branch and bound. At each branch, a nonlinear traffic assignment problem with capacity (Eq. (3c)) and MOD node controlling constraints (Eq. (3d)) is solved. The capacity constraints of fixed-route links are removed using a Lagrangian relaxation approach (Algorithm 2). The resulting non-linear traffic assignment problem is solved with a Frank-Wolfe algorithm (Algorithm 3). Feasibility of the original problem in each branch involves checking the binary constraints. 4.1.1. branch and bound algorithm For each branch, the set of ğ‘¦ğ‘™ (ğ‘£ğ‘–) constrained to be 0 forms set ğ‘Œ0 (ğ‘‰0), the set of ğ‘¦ğ‘™ (ğ‘£ğ‘–) constrained to be 1 forms set ğ‘Œ1 (ğ‘‰1). For each branch, we do the following modification to the network to make sure that constraints (3c) and (3e) are met. â€¢ For ğ‘¦ğ‘™ âˆˆ ğ‘Œ0, the corresponding link ğ‘™ is removed from the network for this branch. â€¢ For ğ‘¦ğ‘™ âˆˆ ğ‘Œ1, all the other links connecting the same nodes owned by the same operator to represent
different service frequency options are removed from the network for this branch. â€¢ For ğ‘£ğ‘– âˆˆ ğ‘‰0, all the links incident on MOD node ğ‘– are removed for this branch. â€¢ For ğ‘£ğ‘– âˆˆ ğ‘‰1, all the MOD nodes owned by the same operator with a fleet size different from the fleet size associated with node ğ‘– should be added to ğ‘‰0. We denote the integral-relaxed ğ¿1 of a branch as ğµ(ğ‘Œ1 ,ğ‘Œ0 ,ğ‘‰1 ,ğ‘‰0) . Following the framework of a conventional Branch and Bound algorithm, each ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) is solved with Algorithm 1. The solution of ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) includes ?Ì‚?ğ‘…, ?Ì‚?ğ¿, ?Ì‚?, ?Ì‚?, ?Ì‚?ğ¿1 , ğ‘ğ‘›ğ‘‘ ?Ì‚?, which denote a vector of path flows on matched paths ğ‘Ÿ âˆˆ ğ‘…ğ‘  âˆ—, ğ‘  âˆˆ ğ‘†, a vector of link flows on all links ğ‘™ âˆˆ ğ´, a vector of values of ğ‘¦ğ‘™ of fixed-route links ğ‘™ âˆˆ ğ´ğ¹, a vector of values of ğ‘£ğ‘– of MOD nodes ğ‘– âˆˆ ğ‘ğ‘€ , objective function value, and a vector of Lagrange multipliers of the capacity constraints of fixed links ğ‘™ âˆˆ ğ´ğ¹. We denote the solution set which includes all solution variable of a branch as ?Ì‚? = [?Ì‚?ğ‘…, ?Ì‚?ğ¿ , ?Ì‚?, ?Ì‚?, ?Ì‚?ğ¿1 , ?Ì‚?, ğ‘Œ1, ğ‘Œ0, ğ‘‰1, ğ‘‰0]. For finding a solution to ğ¿1, the algorithm stops when all branches are closed. A gap between the upper bound and lower bound can be monitored in cases where the maximum run time is exceeded. 4.1.2. lagrangian relaxation To handle the capacity constraints for the fixed-route links, we adopt the Lagrangian relaxation method
from Crainic et al. (2001), which is designed to work with branch and bound algorithms. To improve
accuracy, a redundant set of constraints Eq. (12) is added, where ğ‘ğ‘ ğ‘™ = min{ğ‘‘ğ‘ , ğ‘¤ğ‘ ğ‘™}. This set of constraints is named as the strong forcing constraints, with Lagrange multipliers of ğ›½ğ‘ ğ‘™. ğ‘¥ğ‘ ğ‘™ â‰¤ ğ‘ğ‘ ğ‘™ğ‘¦ğ‘™ , âˆ€ğ‘™ âˆˆ ğ´ğ¹ , âˆ€ğ‘  âˆˆ ğ‘† (ğ›½ğ‘ ğ‘™) (12)
The strong forcing constraints (12) can be relaxed in a Lagrangian way. The capacity constraints in
Eq. (3c) are replaced by Eq. (13) with a Lagrange multiplier of ğ›¾ğ‘™ . With the replacement, ğ‘¦ğ‘™ can be computed as Eq. (14), where ğ‘ğ‘™(ğ›½) = ğ‘ğ‘™ âˆ’ âˆ‘ ğ‘ğ‘ ğ‘™ğ›½ğ‘ ğ‘™ğ‘  . âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘ âˆˆğ‘† â‰¤ ğ‘¤ğ‘™ , âˆ€ğ‘™ âˆˆ ğ´ğ¹ (ğ›¾ğ‘™) (13)
ğ‘¦ğ‘™ = { âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† ğ‘¤ğ‘ ğ‘™ â„ , if ğ‘ğ‘™(ğ›½) â‰¥ 0
1, otherwise (14)
We relax Eq. (3d) similarly as relaxing Eq. (3c). First, a redundant set of constraints is added as Eq. (15) with Lagrange multipliers ğœ‚ğ‘ ğ‘™. ğ´ğ‘– + are the outbound links of MOD node ğ‘–, which include MOD links and MOD egress links. ğ‘¥ğ‘ ğ‘™ â‰¤ ğ‘‘ğ‘ ğ‘£ğ‘– , âˆ€ğ‘– âˆˆ ğ‘ğ‘€ , ğ‘™ âˆˆ ğ´ğ‘– +, ğ‘  âˆˆ ğ‘† (ğœ‚ğ‘ ğ‘™) (15)
Then Eq. (15) are relaxed in a Lagrangian way. The node controlling constraints in Eq. (3d) are
replaced by Eq. (16) with Lagrange multipliers ğœ†ğ‘™. With the replacement, ğ‘£ğ‘– can be computed as Eq. (17), where ğ‘ğ‘–(ğœ‚) = ğ‘ğ‘– âˆ’ âˆ‘ ğ‘‘ğ‘  âˆ‘ ğœ‚ğ‘ ğ‘™âˆ€ğ‘™âˆˆğ´ğ‘– +ğ‘ âˆˆğ‘† . âˆ‘ ğ‘¥ğ‘ ğ‘™ ğ‘ âˆˆğ‘† â‰¤ âˆ‘ ğ‘‘ğ‘  ğ‘ âˆˆğ‘†
, âˆ€ğ‘– âˆˆ ğ‘ğ‘€ , ğ‘™ âˆˆ ğ´ğ‘– + (ğœ†ğ‘™) (16)
ğ‘£ğ‘– = { âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ , ğ‘–ğ‘“ ğ‘ğ‘–(ğœ‚) â‰¥ 0
1, ğ‘œğ‘¡â„ğ‘’ğ‘Ÿğ‘¤ğ‘–ğ‘ ğ‘’ (17)
The relaxed objective function is shown in Eq. (18). The relaxation of Eq. (3d) leads to cost changes
of MOD node outbound links, including MOD links (ğ´ğ‘€) and MOD egress links. MOD egress links are denoted as ğ‘™ âˆˆ ğ´ğ¸. ğ‘ğ¿1(ğœ¸, ğœ·, ğ€, ğœ¼) = âˆ‘ âˆ‘ ğ‘¡ğ‘™ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´0âˆªğ´ğ·ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ (ğ‘¡ğ‘™ + ğ›¾ğ‘™ + ğ‘ğ‘™(ğ›½)
+
ğ‘¤ğ‘™ â„ + ğ›½ğ‘ ğ‘™) ğ‘¥ğ‘ ğ‘™
ğ‘™âˆˆğ´ğ¹ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ (ğ‘¡ğ‘™ + ğ‘šğ‘™ + ğœ†ğ‘™ + ğ‘ğ‘–(ğœ‚)
+
âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ + ğœ‚ğ‘ ğ‘™)ğ‘¥ğ‘ ğ‘™
ğ‘™âˆˆğ´ğ‘€ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ (ğœ†ğ‘™ + ğ‘ğ‘–(ğœ‚)
+
âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ + ğœ‚ğ‘ ğ‘™)ğ‘¥ğ‘ ğ‘™
ğ‘™âˆˆğ´ğ¸ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ« ğœğ‘™(ğ‘¤; â„)ğ‘‘ğ‘¤ âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘†
0ğ‘™âˆˆğ´0ğ‘€
+ ğ‘ğ‘œğ‘›ğ‘ ğ‘¡ğ‘ğ‘›ğ‘¡ğ‘ 
(18)
In subgradient optimization, the Lagrange multipliers are updated from 0 when the corresponding
constraints are broken. However, constraints Eqs. (15) â€“ (16) will never be broken after removing ğ‘£ğ‘–. Hence, (ğœ†ğ‘™ + ğ‘ğ‘–(ğœ‚) +
âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ + ğœ‚ğ‘ ğ‘™) will always be ğ‘ğ‘– âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ for all concerned MOD and MOD egress links,
which means that the relaxed objective can be rewritten as ğ¿1 â€² in Eq. (19). ğ‘ğ¿1â€² (ğœ¸, ğœ·) = âˆ‘ âˆ‘ ğ‘¡ğ‘™ğ‘¥ğ‘ ğ‘™ ğ‘™âˆˆğ´0âˆªğ´ğ·ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ (ğ‘¡ğ‘™ + ğ›¾ğ‘™ + ğ‘ğ‘™(ğ›½)
+
ğ‘¤ğ‘™ â„ + ğ›½ğ‘ ğ‘™) ğ‘¥ğ‘ ğ‘™
ğ‘™âˆˆğ´ğ¹ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ (ğ‘¡ğ‘™ + ğ‘šğ‘™ + ğ‘ğ‘–
âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ )ğ‘¥ğ‘ ğ‘™
ğ‘™âˆˆğ´ğ‘€ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ‘ ğ‘ğ‘–ğ‘¥ğ‘ ğ‘™
âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† ğ‘™âˆˆğ´ğ¸ğ‘ âˆˆğ‘†
+ âˆ‘ âˆ« ğœğ‘™(ğ‘¤; â„)ğ‘‘ğ‘¤ âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘†
0ğ‘™âˆˆğ´0ğ‘€
+ ğ‘ğ‘œğ‘›ğ‘ ğ‘¡ğ‘ğ‘›ğ‘¡ğ‘ 
(19)
Subgradient optimization of estimating Lagrange multipliers ğ›¾ğ‘™ and ğ›½ğ‘ ğ‘™ are shown in Algorithm 1. Algorithm 1 is stopped when the change of the Lagrange multipliers is small enough, i.e. when the L2 norm of change of the vector [ğœ¸, ğœ·] between 2 consecutive iterations is smaller than a pre-set tolerance ğœ–. Algorithm 1. Subgradient optimization for each branch. Initialize path sets ?Ì‚?ğ‘  = [ ] for all OD pairs ğ‘  âˆˆ ğ‘†. ?Ì‚? = [?Ì‚?ğ‘ , âˆ€ğ‘  âˆˆ ğ‘†]. Initialize Lagrange multipliers ğ›¾ğ‘™ = 0, âˆ€ğ‘™ âˆˆ ğ´ğ¹ and ğ›½ğ‘ ğ‘™ = 0, âˆ€ğ‘™ âˆˆ ğ´ğ¹, âˆ€ğ‘  âˆˆ ğ‘† While the L2 norm of the change of [ğœ¸, ğœ·] between 2 consecutive iterations > tolerance ğœ–:
Step size  = 1/iteration number. Solve ğ¿1 â€² using Algorithm 2 with ğ›¾ğ‘™ and ğ›½ğ‘ ğ‘™, obtaining link flows ğ¹ğ‘‹ and updated path set ?Ì‚?. Update ğ›¾ğ‘™ with ğ¹ğ‘‹: ğ›¾ğ‘™ = max {0, ğ›¾ğ‘™ + ğœƒ(âˆ‘ ğ‘¥ğ‘ ğ‘™ âˆ—
ğ‘ âˆˆğ‘† âˆ’ ğ‘¤ğ‘™)}. Update ğ›½ğ‘ ğ‘™ with ğ¹ğ‘‹: ğ›½ğ‘ ğ‘™ = max {0, ğ›½ğ‘ ğ‘™ + ğœƒ(ğ‘¥ğ‘ ğ‘™
âˆ— âˆ’ ğ‘ğ‘ ğ‘™)}. Return ?Ì‚?, ğ¹ğ‘‹ , ğœ¸, ğœ· 4.1.3. modified frank-wolfe algorithm After relaxing capacity and MOD node controlling constraints with Lagrange relaxation, ğ¿1 is reduced to a traffic assignment problem with congestion effects on MOD access links (ğ¿1 â€² ), which can be solved with a Frank-Wolfe algorithm (Frank and Wolfe, 1956; LeBlanc et al., 1975) shown in Algorithm 2. The algorithm is stopped when ğ›¼ is smaller than a tolerance ğœ€ for ğ¶ consecutive iterations, where ğ¶ and ğœ€ are pre-set parameters. Algorithm 2. Modified Frank-Wolfe algorithm for solving ğ¿1
â€² . Initialize current link flow set ğ¹ğ‘‹: demand of each OD pair all assigned to dummy links. Count = 0. For each OD pair ğ‘  âˆˆ ğ‘†:
Compute link costs of fixed-route links with ğœ¸, ğœ·: ğ‘¡ğ‘ ğ‘™ â€² = ğ‘¡ğ‘™ + ğ›¾ğ‘™ +
ğ‘ğ‘™(ğ›½) +
ğ‘¤ğ‘™ â„ + ğ›½ğ‘ ğ‘™. Compute link costs of MOD links: ğ‘¡ğ‘ ğ‘™ â€² = ğ‘¡ğ‘™ + ğ‘šğ‘™ + ğ‘ğ‘– âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ . Compute link costs of MOD egress links: ğ‘¡ğ‘ ğ‘™ â€² =
ğ‘ğ‘– âˆ‘ ğ‘‘ğ‘ ğ‘ âˆˆğ‘† â„ . Compute link costs of MOD access links with current link flows: ğ‘¡ğ‘ ğ‘™ â€² = ğœğ‘™(âˆ‘ ğ‘¥ğ‘ ğ‘™ âˆ— ğ‘ âˆˆğ‘† ; â„). (Cost of transfer links and walking links are the same as original.) While Count < ğ¶: Find the shortest path of each OD pair ğ‘  âˆˆ ğ‘†, save the paths found to path sets ?Ì‚?ğ‘ , ğ‘  âˆˆ ğ‘†. Assign all demand each OD pair to the shortest paths. Aggregate assigned path flows to obtain auxiliary link flows ğ¹ğ‘Œ. Compute the derivative of Eq. (19) with respect to the vector of ğ‘¥ğ‘ ğ‘™ : ğ‘‘ğ‘‚(ğ›¾,ğ›½)
ğ‘‘ğ‘¥ (ğ‘¥). Solve ğ‘‘ğ‘‚(ğ›¾,ğ›½)
ğ‘‘ğ‘¥ (ğ¹ğ‘‹ + ğ›¼(ğ¹ğ‘Œ âˆ’ ğ¹ğ‘‹)) for ğ›¼.
Update ğ¹ğ‘‹: ğ¹ğ‘‹ = ğ¹ğ‘‹ + ğ›¼(ğ¹ğ‘Œ âˆ’ ğ¹ğ‘‹). If ğ›¼ < tolerance ğœ€:
Count = Count + 1. Else:
Count = 0
Return ğ¹ğ‘‹, ?Ì‚?. For each branch ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0), Algorithm 1 obtains the Lagrange multipliers, but not the flows (?Ì‚?ğ‘…, ?Ì‚?ğ¿) directly. Path flows ?Ì‚?ğ‘… need to be obtained with a linear programming assigning demand to the paths in the path set ?Ì‚? = [?Ì‚?ğ‘ , âˆ€ğ‘  âˆˆ ğ‘†] iteratively updated by Algorithm 2. Path flow solution ?Ì‚?ğ‘… of the branch ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) can be obtained by solving a linear program minimizing system total adjusted travel cost, where adjusted link costs are the coefficients in Eq. (19). Flows of the MOD links should be the same as the MOD flows output from the final iteration of subgradient optimization, which can be formulated as
equality constraints. OD demand is also formulated as equality constraints. Link flows ?Ì‚?ğ¿ can be obtained after having ?Ì‚?ğ‘…. Then ?Ì‚? and ?Ì‚? can be obtained using Eq. (14) and Eq. (17). With ?Ì‚?ğ¿ , ?Ì‚? and ?Ì‚? known, the corresponding equilibrium objective value ?Ì‚?ğ¿1 can be computed using Eq. (3a). Proposition 4. Exact solution algorithm for ğ¿1. The proposed branch and bound algorithm with branching shown in Fig. 3 is an exact algorithm for finding an optimal solution to ğ¿1. Proof. The branch and bound relaxes the integral constraints of variables ğ‘¦ğ‘™ and ğ‘£ğ‘– . Only branches whose solution satisfies the integral constraints are considered feasible. These feasible solutions are used in updates of the upper bound. Since the nonlinear program after relaxing the set of binary variables is convex and the combinations of binary variables are finite, the Lagrange relaxation and Frank-Wolfe portions will converge to exact upper bounds. âˆ 4.2. bounded heuristic for a locally stable solution Due to Lemma 1, finding a MaaS platform equilibrium requires finding a stable solution (i.e. solving ğ¿1ğ¶). We propose integrating ğ¿2 and ğ¿3 into the exact solution algorithm above that guarantees a locally stable MaaS platform equilibrium that may require subsidy as shown in Fig. 3 with the â€œStability and Pricingâ€ component. Proposition 5. The proposed heuristic in Fig. 3 guarantees a locally stable solution that may or may not require subsidy. Proof. A stable integral solution found using ğ¿2 without subsidy means that a locally stable solution (?Ìƒ?ğ¿1ğ¶) is found, where ?Ìƒ?ğ¿1ğ¶ â‰¥ ğ‘ğ¿1ğ¶ âˆ— . The globally stable MaaS platform equilibrium (ğ‘ğ¿1ğ¶ âˆ— ) is not ensured to be found. The solution to ğ¿1ğ¶ may be prematurely pruned in the branch and bound process if the solution is under an integral branch for ğ¿1. However, if the optimal solution of ğ¿1 is also locally stable, it is ensured as the MaaS platform equilibrium since no stable solution with lower objective value exists. In the same manner, the optimal ğ‘ğ¿1ğ‘† âˆ— may be prematurely pruned, but when all branches are closed
we are guaranteed to have a feasible solution to a subsidized MaaS platform equilibrium. We denote this solution as ?Ìƒ?ğ¿1ğ‘†, where ?Ìƒ?ğ¿1ğ‘† â‰¥ ğ‘ğ¿1ğ‘† âˆ— . In other words, the algorithm in Fig. 3 is guaranteed to obtain either ?Ìƒ?ğ¿1ğ‘† (requiring subsidy) or ?Ìƒ?ğ¿1ğ¶ (not requiring subsidy), whichever performs better. âˆ
Two sets of constraints are relaxed in the branch and bound: the integral constraints of ğ‘¦ğ‘™ and ğ‘£ğ‘–, and stability constraints. Algorithm 3 shows the process of solving one branch of branch and bound integrating ğ¿2 and ğ¿3. We denote the integral-stability-relaxed problem of a branch as ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0), which can be solved with Algorithm 1. When an integral solution is found after solving ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0), we solve the cost allocation problem (ğ¿2) for the corresponding matching. If ğ¿2 is feasible, the stable outcome space is nonempty. With a non-empty stable outcome space and an ğ¿1 objective value lower than the lowest subsidized objective value found yet, the upper bound is updated and a locally stable solution without subsidy (?Ìƒ?ğ¿1ğ¶) is found. If an empty stable outcome space is reached, we solve the minimum subsidy problem (ğ¿3) to find the subsidized objective value (ğ‘ğ¿1ğ‘†). If the subsidized objective value is lower than the lowest subsidized
objective value found yet, the upper bound needs updating. The complete heuristic for ğ¿1ğ‘† is shown in Fig. 3. When all branches are pruned, the current upper bound (and corresponding stable outcome space) is output as ?Ìƒ?ğ¿1ğ‘†. Algorithm 3. One branch of branch and bound for bounded heuristic. Inputs: sets of integer variables constrained to be 1 and 0: ğ‘Œ1, ğ‘Œ0, ğ‘‰1, ğ‘‰0; solution of the branch with an integral solution and the lowest subsidized objective value found yet: ?Ìƒ?ğ¿ , ?Ìƒ?ğ‘…, ?Ìƒ?, ?Ìƒ?, ?Ìƒ?, ğ‘ˆ, ?Ìƒ?, ?Ìƒ?, ğ‘ğ¿1ğ‘†, â„š. Solve ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) with Algorithm 1 to obtain ?Ì‚? = [?Ì‚?ğ‘…, ?Ì‚?ğ¿ , ?Ì‚?, ?Ì‚?, ?Ì‚?ğ¿1 , ?Ì‚?, ğ‘Œ1, ğ‘Œ0, ğ‘‰1, ğ‘‰0]. If ?Ì‚?, ?Ì‚? are all integers: Solve ğ¿2(?Ì‚?) to obtain ğ‘ˆ, ?Ì‚?. If ğ¿2(?Ì‚?) is feasible: ?Ì‚? = []. ?Ì‚?ğ¿1ğ‘† = ?Ì‚?ğ¿1 . # A locally stable solution found Add ?Ì‚? to the set of locally stable solutions. Else:
Solve ğ¿3(?Ì‚?) to obtain ?Ì‚?. Total subsidy is ?Ì‚?ğ‘…?Ì‚?. Solve ğ¿2 â€² (?Ì‚?, ?Ì‚?) to obtain ?Ì‚?, ?Ì‚?. ?Ì‚?ğ¿1ğ‘† = ?Ì‚?ğ¿1 + ?Ì‚?ğ‘…?Ì‚?. If ?Ì‚?ğ¿1ğ‘† < ğ‘ğ¿1ğ‘†:
?Ìƒ?ğ‘… = ?Ì‚?ğ‘… , ?Ìƒ?ğ¿ = ?Ì‚?ğ¿ , ?Ìƒ? = ?Ì‚?, ?Ìƒ? = ?Ì‚?, ğ‘ğ¿1ğ‘† = ?Ì‚?ğ¿1 , ?Ìƒ? = ?Ì‚?, ğ‘ˆ = ?Ì‚?, ?Ìƒ? = ?Ì‚?, ?Ìƒ? = ?Ì‚?. Else:
If ?Ì‚?ğ¿1 < ğ‘ğ¿1ğ‘†:
Append ?Ì‚? to â„š. Return ?Ìƒ?ğ¿ , ?Ìƒ?ğ‘… , ?Ìƒ?, ?Ìƒ?, ?Ìƒ?, ğ‘ˆ, ?Ìƒ?, ?Ìƒ?, ğ‘ğ¿1ğ‘†, â„š, the set of locally stable solutions. # Updated current best Subsidized MaaS platform equilibrium
We denote a cost allocation problem given an integral solution ?Ì‚? of ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) as ğ¿2(?Ì‚?). The solution of ğ¿2(?Ì‚?) includes ?Ì‚? and ?Ì‚? (buyer optimal or seller optimal or both), which denote a vector of usersâ€™ payoffs of users ğ‘  âˆˆ ğ‘† and a vector of link fares of matched links ğ‘™ âˆˆ ğ´ğ‘Ÿ , ğ‘Ÿ âˆˆ ğ‘…ğ‘ 
âˆ—, ğ‘  âˆˆ ğ‘†. We denote a subsidy problem given an integral solution ?Ì‚? of ğµ(ğ‘Œ1,ğ‘Œ0,ğ‘‰1,ğ‘‰0) as ğ¿3(?Ì‚?). The solution of ğ¿3 is ?Ì‚?, which denotes a vector of optimal subsidies on matched paths ğ‘Ÿ âˆˆ ğ‘…ğ‘ 
âˆ—, ğ‘  âˆˆ ğ‘†. We denote the cost allocation with the solved subsidies as ğ¿â€²2(?Ì‚?, ?Ì‚?). Solution of ğ¿2
â€² also includes ?Ì‚? and ?Ì‚?. We show that the solution has a worst-case bound defined by the subsidized equilibrium objective of
the matching solution for ğ¿1 (Corollary 2). Corollary 2. Worst-case bound. The heuristic for ğ¿1ğ‘† in Fig. 3 has an objective value ?Ìƒ?ğ¿1ğ‘† bounded from above, i.e. ?Ìƒ?ğ¿1ğ‘† â‰¤ ğ‘ğ¿1 âˆ— (ğ’™, ğ’š, ğ’—) + ğ‘ğ¿3|(ğ’™,ğ’š,ğ’—) âˆ— . Proof. The bound used in the heuristic for ğ¿1ğ‘† (ğ‘ğ¿1(ğ’™, ğ’š, ğ’—) + ğ‘ğ¿3|(ğ’™,ğ’š,ğ’—)) is greater than or equal to
the bound used in the exact algorithm for ğ¿1 (ğ‘ğ¿1(ğ’™, ğ’š, ğ’—)). The larger bound still ensures that the optimal solution of ğ¿1 is found in the branch and bound algorithm. Hence the final solution ?Ìƒ?ğ¿1ğ‘† found by the heuristic is ensured to have a subsidized objective value smaller than the optimal solution of ğ¿1, i.e. ?Ìƒ?ğ¿1ğ‘† â‰¤ ğ‘ğ¿1 âˆ— (ğ’™, ğ’š, ğ’—) + ğ‘ğ¿3|(ğ’™,ğ’š,ğ’—) âˆ— . âˆ
The difference between the exact solution to ğ¿1 and the heuristic for ğ¿1ğ‘† is the upper bound used in the branch and bound. The difference between the upper bounds is the subsidy. If all the integral solutions in the branch and bound algorithm are stable without subsidy (non-empty), the upper bound used in the heuristic is identical to the exact solution to ğ¿1, indicating that the final solution found is also the optimal solution to ğ¿1 and the MaaS platform equilibrium (ğ‘ğ¿1ğ¶ âˆ— ) (Corollary 3). Corollary 3. Optimal condition. The heuristic for ğ¿1ğ‘† in Fig. 3 leads to the optimal solution to ğ¿1 and the MaaS platform equilibrium (ğ‘ğ¿1 âˆ— = ğ‘ğ¿1ğ¶ âˆ— ) if all the integral solutions found by the branch and bound are stable without subsidy (non-empty). Proof. The bound used in the heuristic for ğ¿1ğ‘† (ğ‘ğ¿1(ğ’™, ğ’š, ğ’—) + ğ‘ğ¿3|(ğ’™,ğ’š,ğ’—)) is greater than or equal to
the upper bound used in the exact algorithm for ğ¿1 (ğ‘ğ¿1(ğ’™, ğ’š, ğ’—)) due to the subsidy injected to unstable integer solutions. When all the integer solutions found by the branch and bound are stable without subsidy (non-empty), the upper bound used by the heuristic for ğ¿1ğ‘† is the same as the exact solution algorithm for ğ¿1. In this case, the solution found by the heuristic is also the optimal solution to ğ¿1. Since the optimal solution to ğ¿1 is also stable without subsidy, there is no other stable solution with a lower objective value, indicating that the optimal solution to ğ¿1 is also the MaaS platform equilibrium (ğ‘ğ¿1 âˆ— = ğ‘ğ¿1ğ¶ âˆ— ). 5 numerical experiments Two sets of computational experiments are conducted to illustrate the heuristic of finding a guaranteed locally stable solution (a solution to ğ¿1ğ‘† or ğ¿1ğ¶). The first is used to verify the methodology and illustrate the differences between locally and globally stable solutions. The second, tested on an expanded version of Sioux Falls, illustrates generalizable insights that can be gained from the use of this model. 5.1 small illustrative case We use a toy network shown in Fig. 4 to illustrate how the method works. The original network is shown in Fig. 4(a). All costs are in dollars ($). The solid links represent the fixed-route services, links with the same color are operated by the same operator. Link (21,22) and (21,23) are transfer links between lines, which are without capacity and operating cost with no owners. There are 3 MOD operators (blue, green, brown). The circles represent the service zones that MOD operators can choose from to operate (blue: A,B,C; green: B,C; brown: B,D). Zone A covers transit station node 1. Zone B covers transit station nodes 21,22,23. Zone C covers transit station node 3. Zone D covers transit station node 4. The network is expanded into Fig. 4(b) by creating complete subgraphs for each MOD operator and
adding MOD access links and egress links. Travel cost, operating cost, and capacities are labelled as shown in the legend. The access/wait cost functions of all the MOD operators on all MOD access links ğ‘™ are ğœğ‘™(âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† ; â„) = â„ âˆ’2 âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† . The MOD operating cost parameter of all the MOD operators at all MOD nodes is ğ‘šğ‘™ = 2â„ âˆ’2. Fleet size choices of all MOD operators are 1, 2, and 3. The network is further expanded to Fig. 4(c) to represent the 3 fleet size options. Infrastructure cost of MOD nodes 7, 8, 9, 10, 11, 12, and 13 are 3, 3, 2, 2, 1, 1, and 3, respectively for all fleet size options. Demand is 1,000 from node 1 to 3, and 500 from node 1 to 4. Trip utility ğ‘ˆğ‘  is $9.50 for both OD pairs. The tolerance ğœ– for subgradient optimization is 0.05. The tolerance ğœ€ of Frank-Wolfe is 0.01 and the required consecutive number of iterations meeting the tolerance is 5. The branch and bound algorithm is coded in Python 3.8.5. It converged after running 50 branches in
4h 51min using a laptop with 2.3 GHz Quad-Core Intel Core i7. Three locally stable solutions are found, all without subsidy. The objective values of the 3 solutions are ğ‘ğ¿1ğ¶,1 = 11,850, ğ‘ğ¿1ğ¶,2 = 11,849.875, and ğ‘ğ¿1ğ¶,3 = 11,850.256 Since ğ‘ğ¿1ğ¶,2 = ğ‘ğ¿1 âˆ— , the second solution is the globally stable MaaS platform equilibrium (ğ‘ğ¿1 âˆ— = ğ‘ğ¿1ğ¶ âˆ— = ğ‘ğ¿1ğ¶,2). Flows and corresponding fares of the solution are shown in Fig. 5. In the MaaS platform equilibrium shown in Fig. 5, fixed-route Operators 2, 4, and 6, and MOD
Operators 8, 9, do not enter this market. There are travelers choosing not to use the platform (300 on dummy link from (1,4)), and travelers using one of the three MOD operators (Operator 7) with a flow of 3.5 travelers. Operators 1 and 3 cooperate to serve 200 travelers. Operator 1 is required to offer free operation on link (1,21) while Operator 3 has flexibility to adjust their fare between $1 (buyer-optimal) and $4.5 (selleroptimal) for link (23,4). Operator 7 chooses to operate with a fleet size 1 instead of 2 or 3. The fare of link
(7,13) for the MOD service between (A,C) ranges from $3.71 (buyer-optimal) to $4.50 (seller-optimal). The relatively high cost captures the congestion effect limiting further patronage. Operator revenues under seller-optimal and buyer-optimal allocations are shown in Table 1. The users and operators do not have incentive to unilaterally switch. However, if two users on path [1,3] switch together to path [1,7,13,3], payoff per user becomes ğ‘ˆ1 âˆ’ (ğœ(1,7) + ğ‘¡(7,13) + ğ‘¡(13,3)) âˆ’ ğ‘7+ğ‘13
2 âˆ’
ğ‘š(7,13) = $2, which is positive. The minimum payoff that one user on path [1,3] is allocated is ğ‘ˆ1 âˆ’ ğ‘¡(1,3) âˆ’ ğ‘(1,3) = $0.5 (seller-optimal), which is smaller than the payoff of switching to path [1,7,13,3], indicating that if two users on path [1,3] switch to path [1,7,13,3] together, they would have the incentive of switching. Hence, considering local stability, both the solutions are stable, but it is not globally stable. In the second locally stable solution (ğ‘ğ¿1ğ¶,3), there are 1.75 units of demand on path [1,21,11,12,4] for
OD pair 1 to 4, and the rest of the flows are the same as the optimal solution ğ‘ğ¿1ğ¶,2. MOD operator 9 operates link (11,12) with a fleet size 1. Similar to the first locally stable solution, users and operators do not have incentives to switch to the optimal solution. However, if 1.75 users on path [1,21,23,4] switch to path [1,21,11,12,4], the payoff per user is ğ‘ˆ2 âˆ’ (ğ‘¡(1,21) + ğœ(21,11) + ğ‘¡(11,12) + ğ‘¡(12,4)) âˆ’ ğ‘(1,21) âˆ’ ğ‘11+ğ‘12
1.75 âˆ’
ğ‘š(11,12) = $0.01 (seller-optimal). The minimum payoff that one user on path [1,21,23,4] is allocated is ğ‘ˆ2 âˆ’ (ğ‘¡(1,21) + ğ‘¡(21,23) + ğ‘¡(23,4)) âˆ’ (ğ‘(1,21) + ğ‘(23,4)) = $0.01(seller-optimal), which is the same as the payoff of 1.75 users switching to path [1,21,11,12,4], indicating that the 2 paths are equally attractive. 5.2 sioux falls case The algorithm is further tested on the Sioux Falls network. The traditional Sioux Falls network is modeled as a combination of a walking/transfer network and fixed-route transit service segments. Network parameters (link costs and capacities) are shown in Appendix A. Walking links have 0 operating cost and are not owned by any operator. All fixed transit links have an operating cost of $400. No alternative
capacities are modeled for the fixed-route services. There are 4 fixed transit lines in this case, marked in Fig. 6 with blue (Operator 1), pink (Operator 2), yellow (Operator 3), and green (Operator 4). All other links are walking/transfer links. The four fixed-route operators can choose to operate or not on each of the links they own. Three MOD operators operate in the region, marked with purple (Operator 5), light blue (Operator 6), and orange (Operator 7). Candidate service regions that they cover are marked in Fig. 6. The cost of opening each MOD node is $10, $5, and $15 for MOD operator 5, 6, and 7, respectively. Alternative fleet sizes for all 3 MOD operators are 1 and 2. OD demand is shown in Appendix B. The OD pairs are all the combinations between nodes 1, 2, 12, 18, 13, and 20 (30 OD pairs), totaling 9,700 trip demand. Utility ğ‘ˆğ‘  is $20 for all OD pairs. The access/wait cost function and operating cost function of MOD are the same as the illustrative case. The access/wait cost function is ğœğ‘™(âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† ; â„) = 2â„
âˆ’2 âˆ‘ ğ‘¥ğ‘ ğ‘™ğ‘ âˆˆğ‘† while the MOD link operating cost function is ğ‘šğ‘™ = 4â„ 2. The expanded network has 82 nodes and 748 links. All the nodes covered by each MOD operator are
mutually connected with MOD links as complete subgraphs. The travel costs of MOD links are set to be 75% of the cost of the shortest path between the 2 nodes on the original network. MOD nodes and complete subgraphs are replicated to represent fleet sizes 1 and 2. Corresponding MOD nodes and original nodes are connected with MOD access links and egress links. The tolerance ğœ– for subgradient optimization is 0.05. The tolerance ğœ€ of Frank-Wolfe and the required consecutive number of iterations is 0.01 and 5. All cases are run on a laptop with 2.3 GHz Quad-Core Intel Core i7 and 32 GB 3733 MHz LPDDR4X memory. 5.2.1. base case results The proposed algorithm converges after solving 131 branches, taking 2h 8min (59 sec per branch on average). Flows and fares of the final solution are shown in Fig. 7. The final solution is the only solution found in the by the branch and bound, hence the optimal solution to ğ¿1 (i.e. ğ‘ğ¿1 âˆ— ). The final solution is stable without subsidy, indicating that it is a MaaS platform equilibrium (i.e. ğ‘ğ¿1ğ¶ ) according to Corollary 3. Objective value is $106,400. Even if the MOD links are 25% faster than the shortest path of non-MOD links, there is no MOD
operation due to the high operating and infrastructure costs. Within the 4 transit lines, only the blue line operated by Operator 1 ended up operating. Users who travel on the horizontal direction walk to the stations of the blue line (node 1,3,12,13) and take the blue line. Operator revenue, usersâ€™ payoff, and unserved
demand are shown in the first column of Table 2. Unserved demand is 1,200 (12.4% of total demand). These users are not able to obtain non-negative payoffs given the current market and built environment. 5.2.2. reducing mod operating cost We model a scenario where the MOD operating costs are further reduced for Operator 5 (purple) by 50% to ğ‘šğ‘–ğ‘— = 2â„ 2 . Lower MOD operating costs could mean advances in MOD service technologies. For example, the reduction may be from adoption of better routing and matching algorithms and more efficient rebalancing strategies. In this scenario, the proposed algorithm converges after 165 branches, taking 3h 56 min (86 sec per
branch on average). The final solution requires subsidy. The subsidized objective value is $106,377.82. Three other subsidized MaaS platform equilibria are found, whose subsidized objective value are all higher than the final solution. No locally stable solution without subsidy is found. The flows and fares of the final solution are shown in Fig. 8, in which solid lines represent non-MOD flows and dashed links represent MOD flows. The lower cost of Operator 5 leads to market entry for Operator 5 to serve zones (1, 2, 3, 8, 10, 11, 12,
16) with fleet size 1. Because subsidy is needed, the outcome space is a single solution representing both buyer- and seller-optimal outcomes. Subsidy is required to stabilized path [18,16,1], [18,8,1], and [18,16,12], which are all paths with MOD. Sum of fare and travel cost of a user on path [18,16,1] is $22.51, which exceeds trip utility by $2.51. Hence a $2.51 subsidy per user is injected. Similarly, sum of fare and travel cost of a user on path [18,8,1] is also $22.51, and a $2.51 subsidy per user is injected. For path [18,16,12], sum of fare and travel cost of a user is $20.26, which exceed trip utility by $0.26. Since another walking path [18,16,10,11,12] also connects OD pair (18,12) with a travel cost of $18 (no fare), the userâ€™s payoff of the walking path is $2 per user. Userâ€™s payoff of path [18,16,12] should also be $2 per user to be stable. Hence the subsidy needed for path [18,16,12] is $2.26. Although the operating cost reduction is only for Operator 5, the subsidy induces market entry for
Operator 7 (orange MOD) with a fleet size of 1. This is because some profitable paths involving Operator 5 also involves Operator 7 (path [18,8,1] and [20,8,1]). The benefit of the reduced operating cost of operator 5 is shared by operator 5 and 7, which is a result of coopetition between operators (Remark 1). Remark 1. The proposed model can quantify changes in operating costs for one operator in a MaaS platform inducing other operatorsâ€™ market entry decisions due to coopetitive effects. Operator 5 serves zones 10 and 11 even though no demand directly goes there because of the
congestion effects at zones 12 and 16 are so high they push some travelers to go further away to access MOD service (Remark 2). Remark 2. The proposed model can quantify impacts of congestion on operatorsâ€™ design decisions. Operator revenue, usersâ€™ payoff, and unserved demand are shown in the second column of Table 2. Total unserved demand dropped slightly to 1192.05 (12.3% of total demand). In this case, the impact of a lower operating cost for MOD Operator 5 on total supply of the system is not significant since some of the additional demand comes from fixed-route transit. More MOD operation also leads to higher computation time for each branch. With the same tolerance,
Lagrange multipliers converge more slowly with MOD access links involved, since path costs are affected by the flows on MOD access links. 5.2.3. reducing fixed-route operating cost We model reduced fixed-route operating cost by reducing the operating cost of fixed-route operator 4
(green line) by 60%, which may represent technological improvements as well as public subsidies from outside of the platform. Operating cost of all links on the green line is cut from 400 to 160. The proposed algorithm converges after solving 378 branches, taking 6h 17 min (60 sec per branch on
average). The final solution is locally stable without subsidy. The solution is the same as the base case (Fig. 7) with an objective value of $106,400. There are 51 other subsidized solutions found in branch and bound, whose subsidized objective values are all higher than the final solution. No locally stable solution without subsidy is found. Cost allocation results are shown in the third column of Table 2. The computation time is significantly
higher due to more branches solved, which is caused by a larger upper bound with subsidy added. The optimal solution to ğ¿1 requires subsidy and is shown in Fig. 9. Without subsidy, ğ‘ğ¿1 âˆ— = $106,160. The solution reflects the impact of reduced operating cost of the green line. Links (6,2), (2,6), (6,8), (8,6), (8,16), (16,8) are operated and used. However, the matching is unstable due to path [20,18,16,8,6,2]. The sum of travel cost and fare for one user of the path is $22.8, which is greater than trip utility. To stabilize the path, a subsidy of $2.8 is needed per user resulting in a total subsidy of $280. The subsidized objective value becomes ğ‘ğ¿1 âˆ— + ğ‘ğ¿3 âˆ— = $106,440, which is greater than the locally stable solution to ğ¿1ğ¶ found. Remark 3. A reduction in operating cost to an operator may not have any impact on the market equilibrium due to local stability requirement. 5.2.4. heterogeneous demand In real-life cases, users are heterogeneous. We model two different income groups by assigning
different trip utilities. Demand of every OD pair are evenly split into 2 halves. The one with higher income has a trip utility of ğ‘ˆğ‘  = $24 while the one with lower income has a trip utility of ğ‘ˆğ‘  = $16, resulting in the same population average trip utility as the base case of $20. The proposed algorithm converged after 280 branches, taking 30h 16min (389 sec per branch on
average). Computation time is significantly larger due to larger dimensionality of OD pairs, since the number of user groups is increased from 30 to 60 to represent the two income levels. The final solution is not locally stable without subsidy, which means that it is a solution to ğ¿1ğ‘†, i.e. a feasible solution to the subsidized MaaS platform equilibrium. The subsidized objective value is $105,595.50. There are 13 other subsidized solutions found in branch and bound, with subsidized objective values higher than the final solution found. No locally stable solution without subsidy is found. The solution is shown in Fig. 10, in which solid lines represent non-MOD flows and dashed links
represent MOD flows. Cost allocation results are shown in the last column of Table 2. Compared with the base case, MOD operator 5 enters the market (zones 1, 2, 16) with a fleet size of 1, even if the cost parameters of MOD are the same as the base case. The difference is that only the higher-income users are served. Unserved demand substantially increases from the base case to 2240.22, in which 1,650 (73.7%) are lower-income users. In other words, by simply having a heterogeneous population, we reveal inequities as more mobility services enter the market but only serve users with higher income levels (Remark 4). Remark 4. The modeling of heterogeneous user groups can capture inequities in the market where operators enter primarily to serve higher income users while leaving more lower income users out of the platform. Subsidy is required to stabilized path [18,16,1], and [2,16,18], both paths with MOD chosen by the
higher-income group. The sum of fare and travel cost of a user on path [18,16,1] is $24.51, which requires
a $0.51 subsidy per user. Sum of fare and travel cost of a user on path [2,16,18] is also $27.83, which requires a $3.83 subsidy per user. MOD fares at buyer-optimal and seller-optimal vertices are the same given a very narrow stable outcome space of the paths that involves MOD. 6 conclusion In this study, we propose a MaaS platform design method for MaaS systems which incorporate fixed-
route transit services and MOD services, with dummy links that model usersâ€™ choice of not being a part of the system. The matching problem is formulated as a convex multicommodity network design problem. We
derive local stability conditions corresponding to this matching problem and define the optimum that is further constrained to be locally stable to be a globally stable MaaS platform equilibrium. We show that certain variables for this solution to be unique allowing for market design analysis. An exact solution algorithm is proposed to solve the matching problem. The algorithm has a branch
and bound framework. Each branch is solved through subgradient optimization with a Frank-Wolfe algorithm in each iteration. We prove that due to congestion effects, matchings may be locally unstable. A heuristic is derived from the exact algorithm to solve for a feasible solution to the MaaS platform equilibrium. Local stability is guaranteed by finding a solution that is either naturally stable or subsidized. Two sets of numerical examples are conducted. With the smaller toy case, we verify the model and
algorithm, showing how different locally stable solutions may exist of which one is the globally stable MaaS platform equilibrium. The larger case involves an expanded version of Sioux Falls with 82 nodes and 748 links. We show, among other insights, the following:
â€¢ The proposed model can quantify changes in operating costs for one operator in a MaaS platform inducing other operatorsâ€™ market entry decisions due to coopetitive effects. â€¢ The proposed model can quantify impacts of congestion on operatorsâ€™ design decisions. â€¢ A reduction in operating cost to an operator may not have any impact on the market equilibrium due to local stability requirement. â€¢ The modeling of heterogeneous user groups can capture inequities in the market where operators enter primarily to serve higher income users while leaving more lower income users out of the
platform. The method could be applied to service design of MaaS ecosystems, including network design, pricing,
and subsidy design. The method is able to incorporate services with different levels of flexibility: fixedroute transit (e.g. subway, bus) and MOD (e.g. ride-hailing, ride-sharing, bikesharing), and ensure the stability of the designed system. We can use this model to design external subsidies, fare bundles, different service region designs in the context of a mobility ecosystem, user heterogeneity, and evaluate the impact of a new external mode (which would alter the dummy link travel disutilities by altering the logsums). The current bottleneck to the computation cost is the shortest path finding. In the subgradient
optimization, different OD pairs have different network costs. Hence, the shortest path finding has to be run as one-to-one. When the number of user groups is large, computation cost can grow significantly if high accuracy is required, requiring modeling trade-offs in zone aggregation. Computation cost can be controlled by adjusting the tolerable gap between the upper and lower bound in branch and bound, and tolerance parameters of subgradient optimization and Frank-Wolfe algorithm. If there is a tolerable budget of subsidized system total cost, the branch and bound can be terminated when a solution below the budget is found.